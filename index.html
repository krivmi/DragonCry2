<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=7">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

    <link rel="stylesheet" href="DragonCryCSS.css" type="text/css"/>
    
    <title>Dragon Cry</title>
</head>

<body id="bodycko">
    

       
        <div id="lista">
            <div class="menu">
             <span class="span" style="position: relative; left: 0px;  top:0px; ;"><a href="index.html"><img src="drak_icon3.png" width="80" height="60" onmouseover=" this.src = 'drak_icon_hover.png';" onmouseout="this.src = 'drak_icon3.png';" alt="drak_icon2"/></a> </span>   
             <span class="span" style="position: relative; left: 600px;  bottom:25px; ;"><a class="alista" href="oprojektu.html">O projektu</a> </span>
             <span class="span" style="position: relative; left: 700px;  bottom:25px; ;"><a class="alista" href="draci.html">Draci</a> </span>
             <span class="span" style="position: relative; left: 800px;  bottom:25px; ;"><a class="alista" href="knizky.html">Knížky</a> </span>
            </div>
            
          
        </div>
          <div id="logo">
              <img src="Logo_drak_prvni.png" width="500" height="350" alt="Logo_drak_prvni"/>


        </div>
            
      <div id="obalHry">  
        
            <div id="stredni">
                <p class="nadpisy">Vítejte,</p> <p class="pismo"> tyto stránky vznikly v rámci maturitního projektu, kde jsem měl ukázat znalosti v oblasti tvoření webu a hry 
                v programovacím jazyku JavaScript, následně také HTML5 a CSS. Doufám, že se Vám stránky budou líbit a že si hraní hry užijete stejně,
                jako mě bavilo hru vytvářet. Hodně štěstí! </p>
                <br>
                
                 <p class="nadpisy">O hře</p>
                 <p class="pismo">   Jako hru jsem si zvolil klasickou 2D plošinovku, ve které se budete vyhýbat překážkám, jakmile se frak dotkne 
                 takové překážky, hra skončí. Zkuste tedy vydržet co nejdéle, čím déle vydžíte, tím větší skore se Vám přičte. A nezapomeňte si dávat pozor na zrychlení!
                 Hra se ovládá šipkami na klávesnici. </p>
                <br>
                
                
                
                <div id="platno"><canvas id="mujDrakAnimace" >
                </canvas>
                </div>
            </div>
      <div id ="zapati">    
        <div class="menu"> 
    <p style="position: relative;top:18px">
     Web & design Milan Křivánek 2018</p>
           </div>
      </div>
    </div>


    

    <script>
        /*
        *   UŽ MĚ TO TU SERE :D
        */
        // tu si getneš canvas z documentu
        
        
        var myScore;
        var end;
    
        var canvas = document.getElementById("mujDrakAnimace");
        
                 canvas.width = 640;
                canvas.height = 480;
                
               /* var ctx=canvas.getContext("2d");
                ctx.fillStyle="#FF0000";
                ctx.fillRect(0,0,640,480);
       */
      
       var myObstacle;
        
        // vytvoříš Image() ze kterého pak bereš slicy na ten sprite !!! < to nemáš v tom druhém.
        var MujDrak = new Image();
        MujDrak.src = "./Drak_gif3.png";
         
        function component(width, height, color, x, y) {
                 this.width = width;
                 this.height = height;
                 this.speedX = 0;
                 this.speedY = 0;    
                 this.x = x;
                    this.y = y;    
                     this.update = function() {
        ctx = canvas.getContext("2d");
        ctx.fillStyle = color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
    }
    this.newPos = function() {
        this.x += this.speedX;
        this.y += this.speedY;        
    }    
}

            
        /*  To je to samé jako startGame() jen to nikde nevoláš a je to tu k ničemu
        *   použij to tak že v start game zavoláš tohle
        *   bude to dávat smysl.
        */
        function gameLoop() {
            // tady tohle z toho dělá nekonečnou smyčku, voláš se to furt dokola díky tomuhle příkazu
            // googli co to přesně dělá
            window.requestAnimationFrame(gameLoop);
            // voláš update a render na Draka
            if (Drak.crashWith(myObstacle)) {
                    Drak.stop();
                 } else {
            Drak.update();
            myObstacle.update();
            Drak.render();
            }
        }
        // tu definuješ funkci
        // chová se podobně jako objekt nebo classa v jave něbo tak
        // má attributy a funcke v sobě
        function sprite(options) {
            // tu si nastavíš jakoby objekt který bude mít vlastnosti tohoto objektu
            var that = {};
            // tu nastavíš pár proměnných
            frameIndex = 0,
                tickCount = 0,
                ticksPerFrame = 4,
                numberOfFrames = options.numberOfFrames || 1;
            // tu nastavíš attributy podle options
            that.context = options.context;
            that.width = options.width;
            that.height = options.height;
            that.sx = options.sx;
            that.sy = options.sy;
            that.dx = options.dx;
            that.dy = options.dy;
           
            that.image = options.image;
            that.loop = options.loop || true;
            // ^^^ tohle celé je něco jako konstruktor

            // tu je render
            // tohle to vypíše na canvas
            that.render = function () {
                // vezme a vymizí to
                that.context.clearRect(that.dx,that.dy, that.width, that.height); //vyčistí mi toho draka, aby tam ty jeho obrázky vždycky nezůstávaly
                // vykreslí, mrkni na tu funkci na net
                // mrkni na ty parametry, dá ti to smysl jak to funguje s tím
                // obrázkem který máš nahoře zadefinovaný a jak ho to ořezává
                that.context.drawImage( // Draw the animation
                    that.image,
                    frameIndex * that.width / numberOfFrames,
                    0,
                    that.width / numberOfFrames,
                    that.height,
                    that.dx,
                    that.dy,
                    that.width / numberOfFrames,
                    that.height,
                    
                   
                   );
            };
           that.crashWith = function(otherobj) {
                 var myleft = this.x;
                    var myright = this.x + (this.width);
                    var mytop = this.y;
                 var mybottom = this.y + (this.height);
                  var otherleft = otherobj.x;
                  var otherright = otherobj.x + (otherobj.width);
                  var othertop = otherobj.y;
                  var otherbottom = otherobj.y + (otherobj.height);
                  var crash = true;
                  if ((mybottom < othertop) ||
                            (mytop > otherbottom) ||
                            (myright < otherleft) ||
                     (myleft > otherright)) {
                    crash = false;
                 }
                 return crash;
    } 
            /* that.stop = function() {
                 return Drak.dx = 0;
             }*/
        
            // update
            // tu vždy posuneš o kolik se to má v dalším renderu ožíznou
            // když je to na konci, tak se zas hodí na začátek a furt dokola
            // popřemýšlej nad tím bve spojitzosti drawImage
            that.update = function () {
                 /*Drak.dx += 2;
                 that.newPos = function() {
                         that.dx += that.speedX;
                         that.dy += that.speedY; 
                                 } */
                         if (Keys.up) {
                         Drak.dy+=2;
                                }
                else if (Keys.down) {  // both up and down does not work so check excl.
                     Drak.dy-=2;
                        }

                if (Keys.left) {
                     Drak.dx+=2;
                        }
                else if (Keys.right) {
                      Drak.dx-=2;
                        } 
                 
                 
                tickCount += 1;
                console.log("loop:" + that.loop);
                console.log(tickCount);
                if (tickCount > ticksPerFrame) {
                    tickCount = 0;
                    // If the current frame index is in range
                    console.log("ticketsperframe:" + ticksPerFrame);
                    console.log("frameIndex:" + frameIndex);
                    if (frameIndex < numberOfFrames - 1) {
                        // Go to the next frame
                        frameIndex += 1;
                    } else if (that.loop) {
                        frameIndex = 0;
                    }
                }
            }
            return that;
        }
        // vytváříš instanci spritu a v {} jsou options, které mu dáváš do "konstruktoru"
        var Drak = sprite({
            context: canvas.getContext("2d"), //nastudovat jak se pouzivaji ty zavorky ,- () funkce, [] nějaký array, {} objekt, nebo tělo funkce
            width: 1007,
            height: 100,
            // referenční obrázek
            image: MujDrak,
            // co kolik framů se bude měnit obrázek
            numberOfFrames: 10,
            dx: 60,
            dy: 60   
        });
      
        // tu máš zas to samé jako nahoře
        // start game se zavolá a
        // 1. se řekne woknu aby to volalo pokaždé, když může a je vykreslen nový frame v canvas
        function startGame() {
            // viz gameLoop
            window.requestAnimationFrame(startGame);
            myObstacle  = new component(10, 200, "black", 300, 120);  
            myObstacle.update();
            Drak.update();
            Drak.render();
            
            
        }
        // počká až se načte MujDrak (to je ten obrázek)
        // a pak spustí hru
        MujDrak.addEventListener("load", startGame);
        var Keys = {
        up: false,
        down: false,
        left: false,
        right: false
    };
     window.onkeydown = function(e) {
    var kc = e.keyCode;
    e.preventDefault();

    if      (kc === 39) Keys.left = true;  // only one key per event
    else if (kc === 40) Keys.up = true;    // so check exclusively
    else if (kc === 37) Keys.right = true;
    else if (kc === 38) Keys.down = true;
};

window.onkeyup = function(e) {
    var kc = e.keyCode;
    e.preventDefault();

    if      (kc === 39) Keys.left = false;
    else if (kc === 40) Keys.up = false;
    else if (kc === 37) Keys.right = false;
    else if (kc === 38) Keys.down = false;
}; 
  
   


        /*
        *   na konec nekolik doporučení
        *   1. čti si co jaká funkce dělá
        *   2. pojmenovávej si věci lépe, tzn. MujDrak -> MujDrakImage
        *       je z toho hned zřejmé že nejde o draja, ale o jeho image ...
        *   3. než zkopíruješ kód, tak mu porozuměj, nebo naopak
        *   4. pokud mu nerozumíš, jdi krok po kroku a zkus to pochopit
        *       ručně si ten kód odkrokuj, co se změní, proč se to změní a jaký to má dopad
        *   5. roumíš tomu? ne?  -> jdi na 1.
        *                   ano? -> jdi dál
        *   ... aniž bys pochopil co jak proč co dělá, tak se nepohneš
        *   doporučuji něco zkopírovat a pak to různě upravovat a zkoušet co to dělá
        *   postupně to pak pochopíš
        *   ( teď něco k tomu kodu, nebudu to přepisovat, protože ten index2.html je hotový bordel,
        *     doporučuji ti to celé přepsat tak ať to dává smysl
              tj. zadefinuj si co chceš a žádáš po komponentě a tak insto po spritu
                  přemýšlej nad tím co píšeš obecně a až pak konkrétně
                    - sprit je to co se bude renderovat a má polohu na canvas a může se updatovat, čímž se
                      zpracuje frame toho spritu, jeho poloha atd...
                    - na sprite bude koukat nějaký key listener (googli) který ho bde ovládat
                    - můžeš udělat něco jako MůjDrak, který bude mít v sobě sprite a bude mít v sobě key listener
                    - a pak něco jako Obstacle který bude mít v sobě polohu a každým updatem se konstatně posune tap poloha
                    ... pak mi napiš co a jak dál ...
        */
    </script>

</body>