<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=7">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

    <link rel="stylesheet" href="DragonCryCSS.css" type="text/css"/>
    
    <title>Dragon Cry</title>
</head>

<body id="bodycko">
    

       
        <div id="lista">
            <div class="menu">
             <span class="span" style="position: relative; left: 0px;  top:0px; ;"><a href="index.html"><img src="drak_icon3.png" width="80" height="60" onmouseover=" this.src = 'drak_icon_hover.png';" onmouseout="this.src = 'drak_icon3.png';" alt="drak_icon2"/></a> </span>   
             <span class="span" style="position: relative; left: 600px;  bottom:25px; ;"><a class="alista" href="oprojektu.html">O projektu</a> </span>
             <span class="span" style="position: relative; left: 700px;  bottom:25px; ;"><a class="alista" href="draci.html">Draci</a> </span>
             <span class="span" style="position: relative; left: 800px;  bottom:25px; ;"><a class="alista" href="knizky.html">Knížky</a> </span>
            </div>
            
          
        </div>
          <div id="logo">
              <img src="Logo_drak_prvni.png" width="500" height="350" alt="Logo_drak_prvni"/>


        </div>
            
      <div id="obalHry">  
        
            <div id="stredni">
                <p class="nadpisy">Vítejte,</p> <p class="pismo"> tyto stránky vznikly v rámci maturitního projektu, kde jsem měl ukázat znalosti v oblasti tvoření webu a hry 
                v programovacím jazyku JavaScript, následně také HTML5 a CSS. Doufám, že se Vám stránky budou líbit a že si hraní hry užijete stejně,
                jako mě bavilo hru vytvářet. Hodně štěstí! </p>
                <br>
                
                 <p class="nadpisy">O hře</p>
                 <p class="pismo">   Jako hru jsem si zvolil klasickou 2D plošinovku, ve které se budete vyhýbat překážkám, jakmile se frak dotkne 
                 takové překážky, hra skončí. Zkuste tedy vydržet co nejdéle, čím déle vydžíte, tím větší skore se Vám přičte. A nezapomeňte si dávat pozor na zrychlení!
                 Hra se ovládá šipkami na klávesnici. </p>
                <br>
                
                
                
                <div id="platno"><canvas id="mujDrakAnimace" >
                </canvas>
                </div>
            </div>
      <div id ="zapati">    
        <div class="menu"> 
    <p style="position: relative;top:18px">
     Web & design Milan Křivánek 2018</p>
           </div>
      </div>
    </div>


    

    <script>
       
        var myScore;
        var end;
    
        var canvas = document.getElementById("mujDrakAnimace");
        
                 canvas.width = 640;
                canvas.height = 480;
                
              
      
       var myObstacle;
        
        // vytvořím si Image() ze kterého bere kousky sprite
        var MujDrak = new Image();
        MujDrak.src = "./Drak_gif3.png";
         //tady si zadefinuji vznik překážek
         
      var myGameArea = {
   
    start : function() {
       document.getElementById("mujDrakAnimace")
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.frameNo = 0;        
        this.interval = setInterval(gameLoop, 20);
    },
    clear : function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    },
    stop : function() {
        clearInterval(this.interval);
    }
}

         
        function component(width, height, color, x, y, type) {
                 this.type = type;
                 this.width = width;
                 this.height = height;
                 this.speedX = 0;
                 this.speedY = 0;    
                 this.x = x;
                 this.y = y;    
                     this.update2 = function() {
                         
        ctx = canvas.getContext("2d");
        if (this.type == "text") {
      ctx.font = this.width + " " + this.height;
      ctx.fillStyle = color;
      ctx.fillText(this.text, this.x, this.y);
    } else {
        ctx.fillStyle = color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
    }
    this.newPos = function() {
        this.x += this.speedX;
        this.y += this.speedY;        
             }    
        }
    }

            
        
        function gameLoop() {
            // tomuhle příkazu se to furt volá dokola => nekonečná smyčka
           
            
            window.requestAnimationFrame(gameLoop);
            // volám update a render na Draka
            if (Drak.crashWith(myObstacle)) {
                    alert("narazili jste!");
                 } else {
            /* myGameArea.clear();*/
  
            
           myObstacle.update2();
         
            Drak.update();
            Drak.render();
            
           
            }
        }
        // tu definuji funkci sprite, která má v sobě atributy a funkce
        // chová se podobně jako objekt nebo classa v jave 
       
        function sprite(options) {
            // tu si nastavíš jakoby objekt který bude mít vlastnosti tohoto objektu
            var nastaveniDraka = {
           
            frameIndex = 0,
                tickCount = 0,
                ticksPerFrame = 4,
                numberOfFrames = options.numberOfFrames || 1,
                //konstruktor
            nastaveniDraka:context = options.context,  //volá mi to proměnné z options
            nastaveniDraka:width = options.width,
            nastaveniDraka:height = options.height,
            nastaveniDraka:sx = options.sx,
            nastaveniDraka:sy = options.sy,
           nastaveniDraka:dx = options.dx,
            nastaveniDraka:dy = options.dy,
            nastaveniDraka:image = options.image,
            nastaveniDraka:loop = options.loop || true,
       

          
            // tohle to vypíše na canvas
            nastaveniDraka:render = function () {
                //vykreslí mi toho draka, aby tam ty jeho obrázky vždycky nezůstávaly(vezme a vymizí to)
                nastaveniDraka.context.clearRect(that.dx,that.dy, that.width, that.height); 
                
                nastaveniDraka.context.drawImage( // vykreslí animaci
                    nastaveniDraka.image,
                    frameIndex * that.width / numberOfFrames,
                    0,
                    nastaveniDraka.width / numberOfFrames,
                    nastaveniDraka.height,
                    nastaveniDraka.dx,
                    nastaveniDraka.dy,
                    
                    nastaveniDraka.width / numberOfFrames,
                    nastaveniDraka.height,
                    
                   
                   );
            },
           nastaveniDraka:crashWith = function(otherobj) {
                 var myleft = that.dx;
                 var myright = that.dx; + (that.width);
                 var mytop = that.dy;
                 var mybottom = that.dy + (that.height);
                 var otherleft = otherobj.x;
                 var otherright = otherobj.x + (otherobj.width);
                 var othertop = otherobj.y;
                 var otherbottom = otherobj.y + (otherobj.height);
                 var crash = true;
                  if ((mybottom < othertop) ||
                            (mytop > otherbottom) ||
                            (myright < otherleft) ||
                     (myleft > otherright)) {
                    crash = false;
                 }
                 return crash;
    }, 
            nastaveniDraka:stopMove = function() {
                 alert("narazili jste!");
             },
        
            
            // tu vždy posunu souřadnice o kolik se to má v dalším renderu oříznout
            // když je to na konci, tak se zas hodí na začátek a furt dokola
            
            nastaveniDraka:update = function() {  
                
                
                 /*Drak.dx += 2;   //pak na rychlost
                 that.newPos = function() {
                         that.dx += that.speedX;
                         that.dy += that.speedY; 
                                 } */
        //ovládání šipkami
                         if (Keys.up) {
                         Drak.dy+=2;
                         
                                }
                else if (Keys.down) {  
                     Drak.dy-=2;
                        }

                if (Keys.left) {
                     Drak.dx+=2;
                        }
                else if (Keys.right) {
                      Drak.dx-=1; //aby dozadu létal pomalu
                        } 
                 myObstacle.x += -1;
                 
                tickCount += 1;
                console.log("loop:" + that.loop);
                console.log(tickCount);
                if (tickCount > ticksPerFrame) {
                    tickCount = 0;
                    // Pokud je konkrétní obrázek v dosahu
                    console.log("ticketsperframe:" + ticksPerFrame);
                    console.log("frameIndex:" + frameIndex);
                    if (frameIndex < numberOfFrames - 1) {
                        //hodí mi to další obrázek
                        frameIndex += 1;
                    } else if (that.loop) {
                        frameIndex = 0;
                    }
                }
           
            return nastaveniDraka;
          }    
        };
    }
        // zde vytvářím hodnoty funkci options, kterou mám výše 
        var Drak = sprite(options.nastaveniDraka);
            context; canvas.getContext("2d"), //nastudovat jak se pouzivaji ty zavorky ,- () funkce, [] nějaký array, {} objekt, nebo tělo funkce
            width; 1007,
            height; 100,
            // referenční obrázek
            image; MujDrak,
            // co kolik framů se bude měnit obrázek
            numberOfFrames; 10,
            dx; 60,
            dy; 60,
            
            
      
        // tu máš zas to samé jako nahoře
        // start game se zavolá a
        // 1. oknu se zadá, aby se volalo pokaždé, když může a je vykreslen nový frame v canvas
        function startGame() {
            // podobné gameLoopu, 
            window.requestAnimationFrame(startGame);
          
          
             
            Drak.update();
            Drak.render();
            myObstacle  = new component(10, 200, "black", 300, 0);  
            myScore = new component("30px", "Ariel", "black", 480, 40, "text");
      
            myObstacle.update2();
            myScore.text="SCORE: ";
             myScore.update2();
           /* myGameArea.start();*/
             
            
        }
        // počká až se načte MujDrak (to je ten obrázek)
        // a pak spustí hru
        MujDrak.addEventListener("load", startGame);
        var Keys = {   //ovládání šipkami, zde zadávám, jak se sprite bude chovat, když mám zmáčklou šipku
        up: false,
        down: false,
        left: false,
        right: false
    };
     window.onkeydown = function(e) {
    var kc = e.keyCode;
    e.preventDefault();

    if      (kc === 39) Keys.left = true;  //pouze jedna zmáčknutá klávesa
    else if (kc === 40) Keys.up = true;    
    else if (kc === 37) Keys.right = true;
    else if (kc === 38) Keys.down = true;
};
   //díky těmto dvěma funkcím mi ten drak umí létat diagonálně a bez trhání(zmáčknutí obou šipek)
window.onkeyup = function(e) {
    var kc = e.keyCode;
    e.preventDefault();

    if      (kc === 39) Keys.left = false;
    else if (kc === 40) Keys.up = false;
    else if (kc === 37) Keys.right = false;
    else if (kc === 38) Keys.down = false;
}; 
  
       
    </script>

</body>